!function(e){function t(e,t,n,r,i,s,a){function o(){g.onError&&g.onError(),g.onEnd&&g.onEnd()}function u(){E.request(v,C)}function c(){}function d(e){var t=a.screen.availWidth,n=a.screen.availHeight,r=e.imData,i={},s=[],o=e.xst,u={source:e.source,url:e.url,dpi:t+"x"+n,xst:o,pagetitle:e.pagetitle,pvkey:e.pvkey,appKey:e.appKey,appName:e.appName,cuid:e.cuid,wsid:e.wsid||"",ipv6:e.ipv6||""},c={client:u,service:[],f:e.f||""},s=[],d=[],m={uid:{},appid:{}};for(var l in r){var f=r[l]||{},p=f.imParam;if(p){var v=p.ucid;
v&&!i[v]&&(i[v]=1,s.push(v));var g=p.appid;g&&!m.appid[g]&&(m.appid[g]=1,d.push(g));var y=p.imid;if(!y&&p.imUrl&&h){var S=h.parseUrl(p.imUrl).params;y=S.imid}c.service.push({ucid:v,channel:p.channel,im_type:p.im_type,level1:p.level1,level2:p.level2,level3:p.level3,appid:g,imid:y})}}return{appidList:d,userIdList:s,entryData:c}}i=i||{};var m=i.retryDelay||5e3,l=i.retryCount||3,f=i.miniProgram,p=i.Util,h=new p(a),v="entrySite",g={};n&&n.getCallback&&(g=n.getCallback(v)||{});var y=null,S={entrySite:{onResult:function(e){if(0===e.status)g.onResult&&g.onResult(e),g.onEnd&&g.onEnd();
else{var t=y();t||o()}},onError:function(){var e=y();e||o()},onEnd:function(){}}},_=d(e)||{},C=_.entryData,b=(_.userIdList||[]).join(","),k=(_.appidList||[]).join(","),w={};w[v]=-1===t[v].indexOf("?")?t[v]+"?userid="+encodeURIComponent(b):t[v]+"&userid="+encodeURIComponent(b),w[v]+="&appid="+encodeURIComponent(k),e.pvkey&&(w[v]+="&pvkey="+encodeURIComponent(e.pvkey||""));var I=new r(this,S),E=new s({miniProgram:f},w,I);y=function(){function e(){return-1!==n&&t>=n?!1:(clearTimeout(r),r=setTimeout(function(){t++,E.request(v,C)
},m),!0)}var t=0,n=l,r=0;return e}(),this.entry=u,this.onSuccess=c,this.destroy=function(){}}function n(e,t){function n(n){if(!t)return null;var r=t[n]||{},i={onResult:function(){},onEnd:function(){},onError:function(){}};return r.onResult&&(i.onResult=function(){r.onResult.apply(e,arguments)}),r.onEnd&&(i.onEnd=function(){r.onEnd.apply(e,arguments)}),r.onError&&(i.onError=function(){r.onError.apply(e,arguments)}),i}function r(){}e=e||this,this.destroy=r,this.getCallback=n}function r(){function e(e,t){e&&t&&(s[e]=s[e]||[],s[e].push(t))
}function t(e,t){var n=s[e];if(n)for(var r=n.length-1;r>=0;r--)n[r]===t&&n.splice(r,1)}function n(e){e?s[e]=null:s={}}function r(e){return s[e]}function i(e,t){var n=s[e];if(n)for(var r=0;r<n.length;r++)n[r].apply(null,t)}var s={};this.on=e,this.emit=i,this.off=t,this.offAll=n,this.getEvents=r}function i(){this._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}function s(e,t,n,r,i,s){function a(){if(e){var t=e.getData();return t.aduserid}}function o(t){var n={main:{}};if(e&&e.getData){var r=e.getData();
r.ssid&&(n.talk={ssid:r.ssid},n.talk.im_type=r.imType),n.main.wsid=r.wsid||""}return t&&(n.main.noHeartBeat=1),n}function u(){return P?!1:(l(),P=!0,c(!0),E=setInterval(c,1e3),!0)}function c(e){if(R++,T++,e||1e3*T>v){T=0,v=h;var t=!0;R>15&&(R=0,t=!1);var n=o(t);"function"==typeof g&&(n=g(n)),I.request(S,n)}}function d(e){"number"==typeof e.fetchDelay&&(p=e.fetchDelay)}function m(){v=p,T=0}function l(){clearInterval(E),P=!1}function f(e,t){I.addOrReplaceApi(e,t)}i=i||{};var p=i.fetchDelay||1e3,h=i.timeoutDelay||15e3,v=p,g=i.formatParamsFn,y=i.miniProgram,S="fetch",_=a(),C={};
n&&n.getCallback&&(C=n.getCallback(S)||{});var b={};b[S]={onResult:function(e){C.onResult&&C.onResult(e),m()},onError:function(){m()},onEnd:function(){m()}};var k={};k[S]=-1===t[S].indexOf("?")?t[S]+"?userid="+encodeURIComponent(_):t[S]+"&userid="+encodeURIComponent(_);var w=new r(this,b),I=new s({miniProgram:y},k,w),E=0,T=0,P=!1,R=0;this.isStart=function(){return P},this.addOrReplaceApi=f,this.start=u,this.stop=l,this.updateParams=d,this.destroy=function(){l()}}function a(e,t){function n(){return kt
}function r(e){if(bt){var t={type:"freetime",data:e};y(t)}}function i(t,n,i){if(bt)return!1;if(i=i||{},t=t||{},t.imId=t.imId||t.imid,t.imid=t.imId,wt.imParam=t||{},wt.visitParam=n||{},wt.sdkOptions=i||{},wt.ssid=wt.visitParam.ssid||"",wt.url=i.url,void 0===wt.sdkOptions.isSaveHistory&&(wt.sdkOptions.isSaveHistory=!0),et.addApiParams(at,{wsid:n.wsid,pvKey:n.pvKey,ipv6:i.ipv6}),ut=et.appendPageParams(ut,i),!wt.ssid){var s=et.getSaveKey(wt.imParam,"ssid"),a=St.get(s);a&&(wt.ssid=a)}lt=new j(this,mt),ct=new $({miniProgram:N,method:"GET"},at,lt),ht=new L({minFreeTime:30,callback:r},e),ft=new F({source:ut.referrer,url:ut.url,xst:n.xst,pagetitle:ut.title,pvkey:n.pvKey,appKey:i.appKey,appName:i.appName,cuid:i.cuid,wsid:n.wsid,f:i.f,ipv6:i.ipv6,imData:{im:{imParam:{appid:n.appid,ucid:et.getUserId(n),channel:n.channel,im_type:t.im_type,level1:t.level1,level2:t.level2,level3:t.level3,imid:t.imid}}}},at,lt,j,{miniProgram:N,Util:H},Y,e),pt=new G(this,at,lt,j,{fetchDelay:500,timeoutDelay:1e4,miniProgram:N,formatParamsFn:function(e){var t=0;
2===kt?(t=1,pt.updateParams({fetchDelay:1e3})):pt.updateParams({fetchDelay:3e3});var n=O.getReadData();return e.system=e.system||{},e.system.last_sys_time=n.system.lastTime||"",e.talk=e.talk||{},e.talk.last_mes_time=n.message.lastTime||"",e.talk.connected=t,e}},Y,e),!wt.sdkOptions.cancelEntrySite&&ft&&ft.entry();var o="imlphistory",u=et.getHistoryKey(t,n,i);return vt=new z({maxCount:50,key:u,historyStorageKey:o},Q,e,dt),_t.init({messageTemp:Tt}),gt=new Z({key:u,historyStorageKey:o,getLastMessageId:function(){return vt.getLastMessageId()
},change:function(e){if(e&&e.length){var t=e[e.length-1].message_id;vt.setLastMessageId(t),I("syncMessage",[e])}}},e,dt),C(),bt=!0,I("init"),!0}function s(e,t){return Ct.on(e,t),this}function a(e,t){return Ct.off(e,t),this}function o(e){if(bt&&2!==kt&&1!==kt&&!It){C(),kt=1;var t="connect",n=et.getConnectParams(wt,e);return ct.request(t,n),this}}function u(e){return c(e,!0)}function c(e,t){if(!bt)return void I("error",[{type:"send",data:e}]);var n=E()||{};_();var r="send",i=et.formatMessage(e,n);return t||(Et++,i.seq=Et),wt.sdkOptions.isSaveHistory&&vt.add(i),t||(Tt["send"+i.message_id]={retry:0,data:i},ct.request(r,i),I("debug",[{type:"send",message:"send message",data:i}])),i
}function d(e){var t=E()||{},n=et.formatMessage(e,t);return n}function m(e,t,n){if(e){var r=Tt["send"+e];if(r){var i="send";if(n!==tt)return _t.resetReadStatus(e),void ct.request(i,r.data);if(r.retry>=nt.resendCount)return void ot.emit("error",[{type:"send",data:e,result:t}]);_(),setTimeout(function(){r.retry++,ct.request(i,r.data)},nt.resendDelay)}}}function l(){return _t.getData()}function f(e){return _t.setReadData(e)}function p(e){return _t.checkKefuMessage(e)}function h(e){var t=E()||{},n={ssid:t.ssid,message:e};
n.im_type=t.imType,ct.request("system",n)}function v(e){_();var t="leaveWord",n=(st[e.type]||"未知")+": "+e.content,r=E()||{},i=et.createMessageId(r.ssid,it),s={ssid:r.ssid,content:n,source:"leaveword",msgid:i};return s.message_id=i,s.content_type="text",s.message_time=Date.now(),s.im_type=r.imType,s.imid=r.imid,s.seq=0,ct.request(t,s),I("debug",[{type:"leaveWord",message:"leave word"}]),i}function g(){if(!vt)return void I("error",[{type:"getHistory",data:nt}]);var e=vt.get()||[];return I("history",[e]),e
}function y(e){if(e||e.type){var t=E()||{};e.im_type=t.imType,e.ssid=t.ssid,"object"==typeof e.data&&(e.data=dt.JSON.stringify(e.data));var n="userState";ct.request(n,e)}}function S(e){if(e||e.type){_();var t=E()||{};e.im_type=wt.imParam.im_type||0,e.ssid=t.ssid,"object"==typeof e.data&&(e.data=dt.JSON.stringify(e.data));var n="userAction";ct.request(n,e)}}function _(){ht&&ht.reset()}function C(){pt&&pt.start(),gt&&gt.start()}function b(){pt&&pt.isStart()&&pt.stop(),ht&&ht.stop()}function k(e){if(e)return e.eventName="disconnect",kt=0,b(),delete e.key,void ot.emit("disconnect",[e]);
if(0===kt)return void b();var t="disconnect",n=E(),r={im_type:n.imType,ssid:n.ssid};ct.request(t,r)}function w(){b(),Ct.offAll(),P(lt,function(e){e.destroy(),e=null}),P(ct,function(e){e.destroy(),e=null}),P(ft,function(e){e.destroy(),e=null}),P(pt,function(e){e.destroy(),e=null}),vt=null}function I(e,t){if(Ct.emit(e,t),"message"===e)D(t[0]);else if("readData"===e){var n=t[0]||{};for(var r in n)n.hasOwnProperty(r)&&"0"===n[r]&&delete Tt["send"+r]}}function E(){var e=wt.imParam||{},t=wt.visitParam||{},n={aduserid:et.getUserId(t)||"",ssid:wt.ssid||"",imType:e.im_type||0,imid:e.imid||e.imId||"",msgCount:Et,wsid:t.wsid};
return n}function T(e){if(wt.imParam=wt.imParam||{},wt.visitParam=wt.visitParam||{},M(wt,"ssid",e.ssid),e.ssid){var t=et.getSaveKey(wt.imParam,"ssid");St.save(t,e.ssid,864e5)}M(wt.imParam,"im_type",e.imType),M(wt.visitParam,"aduserid",e.aduserid),M(wt.visitParam,"shop_id",e.shopid),kt=e.connectState,It=e.isForbidden}function P(e,t){if(e)try{t(e)}catch(n){}}function R(){}function D(e){vt.add(e)}function x(){ot.emit=I,ot.updateData=T,ot.disconnect=k,ot.startFreeCheck=R,ot.resend=m,ot.setReadData=f,ot.checkKefuMessage=p,ot.sdkInnerKey=tt,ot.stop=b,ot.start=C,ot.getConnectState=n
}function M(e,t,n){return e&&t&&("number"==typeof n||n)?(e[t]=n,e):void 0}var O=this;t=t||{};var A=t.sdkConfig||{},U=t.EventEmitter,q=t.isMiniProgram||!1,N=t.miniProgram,H=t.Util,K=t.host||A.host||"",L=(A.imTypes,A.defaultImType,t.FreeTimeModel),j=t.Callback,J=t.getImCallbacks,F=t.EntrySite,W=t.SdkDataModel,B=t.request,G=t.FetchData,Q=t.StorageModel,z=t.HistoryModel,V=t.SaveDataModel,X=t.MessageStatusManager,Z=t.SyncMessageModel,$=B.GetRequest,Y=B.PostRequest,et=new W(A),tt=(new Date).getTime().toString("16"),nt={resendCount:2,resendDelay:1e3,heartDely:12e3},rt=K+"/imlp/";
Date.now||(Date.now=function(){return(new Date).getTime()});var it=Date.now(),st={phone:"电话",qq:"QQ",email:"Email",wechat:"微信"},at={connect:rt+"imlp/start",disconnect:rt+"imlp/leave",send:rt+"imlp/send",leaveWord:rt+"imlp/send",heartbeat:rt+"imlp/heart",getMessage:rt+"imlp/message",userState:rt+"imlp/status",userAction:rt+"imlp/action",getAsyncCard:rt+"imlp/getCardMat",entrySite:rt+"track/start",fetch:rt+"heartbeat",system:rt+"imlp/system"},ot={};x();var ut=et.getPageParams(q),ct=null,dt=new H(e),mt=J(ot),lt=null,ft=null,pt=null,ht=null,vt=null,gt=null,yt="imlp_save_base_data",St=new V(Q,e,yt,dt),_t=new X(this),Ct=new U,bt=!1,kt=0,wt={},It=!1,Et=0,Tt={};
this.init=i,this.on=s,this.off=a,this.connect=o,this.send=c,this.addMessage=u,this.leaveWord=v,this.reset=w,this.getData=E,this.disconnect=k,this.getHistory=g,this.resend=m,this.getReadData=l,this.setReadData=f,this.checkKefuMessage=p,this.kefuMessageRead=h,this.getConnectState=n,this.isInit=function(){return bt},this.resetFreeTime=_,this.sendUserAction=S,this.sendUserState=y,this.stop=b,this.start=C,this.formatMessage=d}function o(e){function t(e){return-1!==e.indexOf("baidu.php?url=")||-1!==e.indexOf("link?url=")||-1!==e.indexOf("baidu.php?sc.")?!0:!1
}function n(e,t){for(var n=new RegExp("^https?://"+t+"/imlp","i"),r=new RegExp("^https?://"+t+"/site/[^/]+/.*","i"),i=new RegExp("^https?://"+t+"/imsdk/page","i"),s=[n,r,i],a=!1,o=0;o<s.length;o++)a=a||s[o].test(e);return a}function r(e,t){var n=new RegExp("^https?://"+t+"/imsdk/page","i");return n.test(e)}function i(e){var t=e.indexOf("Android")>-1||e.indexOf("Linux")>-1,n=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),r=null;t?r="android":n&&(r="ios");var i=null;return/(SogouMobileBrowser|SogouMSE)/i.test(e)&&(i="sogou"),{os:r,browser:i}
}function s(e){function t(e){function n(){var e=(y?y+":":"")+"//"+v+S,t=this.params;if(t){var n=[];for(var r in t){var i=t[r];if(null!==i&&void 0!==i){var a=typeof i;if("string"!==a&&"number"!==a)try{i=JSON.stringify(i)}catch(o){continue}n.push(r+"="+encodeURIComponent(i))}}n&&n.length&&(e+="?"+n.join("&"))}return s&&(e+=s),e}var r={};e=e||"";var i=e.indexOf("#"),s="";-1!==i&&(s=e.substring(i),e=e.substring(0,i));for(var a=e.split("?"),o=a[0],u=a[1]||"",c=u.split("&"),d=0;d<c.length;d++){var m=c[d];
if(m){var l=m.split("="),f=l[0],p=l[1]||"";try{p=decodeURIComponent(p)}catch(h){p=l[1]||""}r[f]=p}}var v=o.replace(/\?.*/,"").replace(/^(https?:)?\/\//i,"").replace(/\/.*/,""),g=v.replace(/:\d+$/,""),y=o.replace(/:?\/\/.*/,""),S=o.replace(/^(https?:)?\/\/.*?(\/|$)/i,"");S&&(S="/"+S),this.params=r,this.url=e,this.removeParam=function(e){delete this.params[e],this.url=n.call(this)},this.addParam=function(e,t){this.params[e]=t,this.url=n.call(this)},this.getHost=function(){return v},this.getHostname=function(){return g
},this.getProtocol=function(){return y},this.getPathname=function(){return S},this.removeHash=function(){s="",this.url=n.call(this)},this.setOrigin=function(e){var r=new t(e);y=r.getProtocol(),g=r.getHostname(),v=r.getHost(),this.url=n.call(this)}}return new t(e)}function a(e,t){if(e&&"function"==typeof t)for(var n=0;n<e.length;n++)t(e[n],n)}function o(e){try{return e()}catch(t){}}function u(e,t){if(!t)return e;if(!e)return t;for(var n in t)e[n]=t[n];return e}function c(e){try{return JSON.parse(e)
}catch(t){}}function d(e){try{return JSON.stringify(e)}catch(t){}}function m(t,n){e&&(e.addEventListener?e.addEventListener(t,n):e.attachEvent&&e.attachEvent("on"+t,n))}function l(e,t,n){e=e||"",t&&o(function(){e=t.decode(e,n)});var r=e.split("__")||[],i={channel:r[0]||"",level1:r[1]||"",level2:r[2]||"",level3:r[3]||"",ucid:r[4]||"",imType:r[5]||"",ssid:r[6]||"",appid:r[7]||""};return i}function f(e,t,n){var r=[e.channel||"",e.level1||"",e.level2||"",e.level3||"",e.user_id||e.aduserid||"",e.im_type||"",e.ssid||"",e.appid||""].join("__");
return t&&o(function(){r=t.encode(r,n)}),r}function p(e,t,n){var r=e||{};n&&(r=h(r)),t=t||{};for(var i in t){var s=r[i];s||"number"==typeof s||(r[i]=t[i])}return r}function h(e){var t=d(e);return c(t)}function v(e){e=e||"key";var t=(new Date).getTime().toString(16),n=parseInt(1e5*Math.random()).toString(16),r=e+t+n;return r}function g(e){return"undefined"===e&&(e=void 0),e}function y(e,t){var n=s(t),r=n.params||{},i={referrer:e,urlParams:r,pageUrl:t};return i}function S(e,t,n){if(!e||"string"!=typeof t)return n;
const r=t.split(".");for(var i=e,s=0,a=0,o=r.length;o>a&&i;a++){var u=r[a];i=i[u],s++}return(void 0===i||null===i||s!==r.length)&&(i=n),i}this.isMiniProgramIframe=r,this.createCData=f,this.parseCData=l,this.isChargeLink=t,this.isImlpUrl=n,this.getBrowser=i,this.parseUrl=s,this.eachArray=a,this.trycatch=o,this.mergeObject=u,this.JSON={stringify:d,parse:c},this.bindEvent=m,this.jsonClone=h,this.mergeJson=p,this.createOneKey=v,this.filterEmptyStr=g,this.getPageParams=y,this.getValue=S}function u(e){function t(){u||(i=0,u=setInterval(function(){i+=o,i>=s&&i%5===0&&a(i)
},1e3*o))}function n(){clearInterval(u),u=0}function r(){i=0}var i=0,s=e.minFreeTime||15,a=e.callback||function(){},o=5,u=0;this.start=t,this.stop=n,this.reset=r}function c(e){function t(t){return function(n,r){!n||0!==n.status&&"0"!==n.status?e.emit("error",[{type:t,data:r,result:n}]):e.emit(t,arguments)}}function n(t){return function(n){e.emit("error",[{type:t,data:n}])}}function r(t){return function(n){e.emit("end",[{type:t,data:n}])}}function i(e){return{onResult:t(e),onError:n(e),onEnd:r(e)}
}var s={};return s.connect={onResult:function(t){t=t||{};var n={isForbidden:!1,connectState:0,status:t.status,ssid:t.ssid,awake:t.awake,shopid:t.shopid,aduserid:t.aduserid,imType:t.im_type,robot:0===parseInt(t.robot_status,10)};11===n.status?(e.disconnect(n,{key:e.sdkInnerKey,type:"cheat",result:n}),n.isForbidden=!0):(0===n.status||2===n.status)&&(n.connectState=2),e.updateData(n),0===n.status||2===n.status?(e.startFreeCheck(),e.emit("taskbegin",[n])):e.emit("error",[{type:"taskbegin",data:n,result:t}])
},onError:function(){e.emit("error",[{type:"taskbegin"}]),e.updateData({connectState:0})},onEnd:r("taskbegin")},s.send={onResult:function(t,n){!t||0!==t.status&&"0"!==t.status?n&&n.msgid?e.resend(n.msgid,t,e.sdkInnerKey):e.emit("error",[{type:"send",data:null}]):e.emit("send",arguments)},onError:function(t){t?e.resend(t.msgid,null,e.sdkInnerKey):e.emit("error",[{type:"send",data:null}])},onEnd:r("send")},s.leaveWord=i("leaveWord"),s.userState=i("userState"),s.userAction=i("userAction"),s.entrySite=i("entrySite"),s.fetch={onResult:function(t){t=t||{},t.talk=t.talk||{};
var n=t.talk;if(11===t.status||n&&11===n.status,n&&(void 0!==n.switchtomanual&&e.emit("switchToManual",[n.switchtomanual]),n.message instanceof Array)){if(n.kefuInput&&e.emit("kefuInput",[n.kefuInput.timestamp]),t.system&&t.system.message){var r=e.setReadData(t.system.message);r&&e.emit("readData",[r])}for(var i=d(n.message)||{},s=i.messageList||[],a=[],o=0;o<s.length;o++){var u=e.checkKefuMessage(s[o]);u&&a.push(s[o])}a.length&&e.emit("message",[a]),n.disconnect=n.disconnect||i.disconnect,n.disconnect===!0&&(n.disconnect={from:"service",result:!0});
var c=e.getConnectState();2!==c&&delete n.disconnect,n.disconnect&&e.disconnect(n.disconnect),e.emit("fetch",arguments)}},onError:n("fetch"),onEnd:r("fetch")},s.getMessage=s.fetch,s.disconnect={onResult:function(t,n){!t||0!==t.status&&"0"!==t.status?e.emit("error",[{type:"disconnect",data:n,result:t}]):(e.stop(),e.emit("disconnect",{from:"client",result:t,data:n}))},onError:n("disconnect"),onEnd:r("disconnect")},s}function d(e){e=e||[];for(var t={messageList:[],disconnect:null},n=0;n<e.length;n++){var r=e[n],i=r.content_type,s=r.content||{};
"system"!==i||"cmd"!==s.type||"close"!==s.value?t.messageList.push(r):t.disconnect={from:"service",result:s}}return t}function m(e){function t(){var e="abcdefghijklmnopqrstuvwxyz1234567890";e+=e;var t=e.split("");return i(t),t}function n(e){for(var t=[],n=b.length,i=0;e>i;i++){var s=r()%n;t.push(b[s])}return t.join("")}function r(e){return e=e||1e4,Math.round(Math.random()*e)}function i(e){e.sort(function(){var e=r()%2-1||1;return e})}function s(e){e=e||n(32);var t=e.substr(-6),r=y();return t+=r.toString(16).substr(-10),t+=(r-S).toString(16),"m"+t
}function a(e,t){t=t||{};var n=["wcWord","cardId","pt","ac","t"],r=e.imParam||{},i=e.visitParam||{},s={};s={xst:i.xst||"",query:i.query||"",bidword:i.bidword||"",city:i.city||"",aduserid:i.aduserid||"",level1:r.level1||"",level2:r.level2||"",level3:r.level3||""},s.user_id=i.user_id||"",s.userid=s.user_id,s.user_id_type=i.user_id_type||"",s.abTest=i.abTest||"",s.autoConnect=i.autoConnect||0,s.transparent=i.transparent||"",s.appid=i.appid||"",c(s,"imid",r.imId||r.imid),c(s,"channel",i.channel),c(s,"imlpAccessId",i.imlpAccessId),c(s,"url",i.url||e.url),c(s,"notifyIM",r.notifyIM),c(s,"cipUrl",i.cipUrl),c(s,"cipText",i.cipText);
for(var a=0;a<n.length;a++){var o=n[a];c(s,o,t[o])}return c(s,"im_type",r.im_type,0),s.ssid=e.ssid||"",s.params=i.params||"",s}function o(e){var t={};try{e||(t.url=location.href,t.referrer=document.referrer,t.title=document.title)}catch(n){}return t}function u(e,t){return t=t||{},e=e||{},c(e,"url",t.url),c(e,"title",t.title),c(e,"referrer",t.referrer),e}function c(e,t,n,r){n||void 0!==n&&null!==n?e[t]=n:void 0!==r&&(e[t]=r)}function d(e,t,n){n=n||{};var r=n.historyKey,i=h(t)||"",s=e.im_type,a=e.imId||"",o="msg"+a+s;
return r?"hmsg"+r:i?"uidmsg"+i:o}function m(e,t){e=e||{};var n=e.im_type,r=_[n]||C,i=e.imId||"",s=i+"_"+t;if("bcp"===r.server){var a=Number(e.level2)?e.level2:"",o=Number(e.level3)?e.level3:"";s=[e.level1,a,o,n,t].join("_")}return s}function l(e,t,n){var r=p(t);if(!r||!n)return n;var i={};for(var s in r)e?i[r[s]]=n[s]:i[s]=n[r[s]];return f(i),i}function f(e){for(var t in e){var n=e[t];"number"==typeof n||n||delete e[t]}}function p(e){if("send"===e){var t={type:"content_type",content:"content",ssid:"ssid",contenttext:"contenttext",fromid:"fromid",msgid:"msgid",trigger:"trigger",source:"source",imid:"imid",seq:"seq",sourceTag:"source_tag"};
return t.message_id="message_id",t.message_time="message_time",t.im_type="im_type",t}}function h(e){return e=e||{},e.user_id||e.aduserid}function v(e,t){var n=[];for(var r in t)(t[r]||0===t[r])&&n.push(r+"="+encodeURIComponent(t[r]));var i=n.join("&");for(var r in e)e[r]+=-1===e[r].indexOf("?")?"?"+i:"&"+i;return e}function g(e,t){var n="send";t=t||{};var r=t.ssid||"",i=t.imType||"",a=t.imid||"",o=e.msgid||e.message_id||s(r);e.ssid=r,e.source=e.source||"user",e.message_time=y(),e.msgid=o,e.message_id=o,e.im_type=i,e.imid=a;
var u=p("send");for(var c in u){var d=u[c];c!==d&&(e[c]||0===e[c]||(e[c]=e[d]))}e.type=e.type||e.content_type||"text";var m=l(!0,n,e),f=m.content_type||"text";f+="";var h=_[i]||C;return"1"!==f||"bcp"!==h.server&&"aiservice"!==h.server||(m.content_type="text"),"2"===f&&(m.content_type="image"),m}function y(){return(new Date).getTime()}var S=y(),_=e.imTypes,C=e.defaultImType,b=t();this.getConnectParams=a,this.createMessageId=s,this.getPageParams=o,this.getHistoryKey=d,this.convertInputOutputParam=l,this.getSaveKey=m,this.appendPageParams=u,this.getUserId=h,this.addApiParams=v,this.formatMessage=g
}function l(e,t){function n(e,t){o&&o.setItem(e,t)}function r(e){return o?o.getItem(e):void 0}function i(e){o&&o.removeItem(e)}function s(){o&&o.clear()}function a(){return o&&o.length,0}var o=e.localStorage;t&&(o=e.sessionStorage),this.setItem=n,this.getItem=r,this.removeItem=i,this.clear=s,this.length=a}function f(e,t,n,r){function i(e,t){if(e){var n=e.msgList;if(t instanceof Array){for(var r=0;r<t.length;r++)n.push(t[r]);o=t[t.length-1].message_id}else n.push(t),o=t.message_id;-1!==c&&c>0&&n.length>c&&n.splice(0,n.length-c),e.updateTime=(new Date).getTime()
}}function s(e){try{var t=r.JSON.stringify(e);u.setItem(m,t)}catch(n){"QuotaExceededError"===n.name||22===n.code}}function a(){var e=null;try{e=u.getItem(m)}catch(t){}if(e)try{e=r.JSON.parse(e)}catch(t){}return e=e||{}}var o=null,u=new t(n),c=e.maxCount||50,d=e.key,m=e.historyStorageKey;this.get=function(){var e=a(),t=null,n=e[d];return n&&(t=n.msgList||[],n.updateTime=(new Date).getTime()),t&&(o=t[t.length-1].message_id),t},this.add=function(e){var t=a();t[d]=t[d]||{};var n=t[d];n.msgList=n.msgList||[],i(n,e),s(t)
},this.getLastMessageId=function(){return o},this.setLastMessageId=function(e){o=e},this.remove=function(){var e=a(),t=e[d];t&&(delete e[d],s(e))},this.changeKey=function(e){var t=a(),n=t[d];n&&(t[e]=t[d],t[e].updateTime=(new Date).getTime(),delete t[d],s(t)),d=e}}function p(e,t,n,r){function i(e){return e?m:d}function s(e){var t=i(e),s=t.getItem(n),a=r.JSON.parse(s)||{};a=u(a);var o=r.JSON.stringify(a);return t.setItem(n,o),a}function a(e,t,a,o){var u=i(o),c=s(o)||{},d=0;a&&(d=a+(new Date).getTime()),c[e]={timestamp:d,data:t};
var m=r.JSON.stringify(c);u.setItem(n,m)}function o(e,t){var n=s(t)||{},r=n[e]||{};return r.data}function u(e){if(e){var t=(new Date).getTime();for(var n in e){var r=e[n];c(r,t)&&delete e[n]}return e}}function c(e,t){return t=t||(new Date).getTime(),e.timestamp&&e.timestamp<t?!0:!1}var d=new e(t),m=new e(t,!0);this.save=a,this.get=o}function h(e,t,n){function r(e){if(e=e||t.event,e&&e.key===c){var r=n.JSON.parse(e.newValue)||{};if(r[u]){var i=r[u].msgList;if(i&&i.length){for(var s=m(),a=[],o=!1,l=0;l<i.length;l++){var f=i[l];
f.message_id!==s?o&&a.push(f):o=!0}o||(a=i),a&&a.length&&d(a)}}}}function i(){o||(o=!0,n.bindEvent("storage",r))}function s(){o=!1}function a(){s()}var o=!1,u=e.key,c=e.historyStorageKey,d=e.change||function(){},m=e.getLastMessageId||function(){};this.start=i,this.stop=s,this.destroy=a}function v(){this.request=function(){},this.startHeartbeat=function(){},this.stopHeartbeat=function(){},this.destroy=function(){this.stopHeartbeat()},this.addOrReplaceApi=function(){}}function g(e){function t(){}function n(t){if(!t)return"";
if("POST"===i&&"json"===e.contentType)return JSON.stringify(t);var n=[];for(var r in t){var s=t[r];"number"==typeof s?n.push(r+"="+s):s&&"object"==typeof s?n.push(r+"="+encodeURIComponent(JSON.stringify(s))):s&&"string"==typeof s&&n.push(r+"="+encodeURIComponent(s))}return n.join("&")}function r(e){if(e)for(var t in e)e.hasOwnProperty(t)&&f.setRequestHeader(t,e[t]||"")}var i=(e.type||"GET").toUpperCase(),s=e.url,a=e.data,o="application/x-www-form-urlencoded",u=e.dataType;"json"===e.contentType&&(o="application/json");
var c=e.error||t,d=e.success||t,m=e.complete||t;if(!s)return c(),void m();var l=n(a);"GET"===i&&l&&(s+=-1===s.indexOf("?")?"?"+l:"&"+l);var f=new XMLHttpRequest;f.open(i,s,!0),f.setRequestHeader("Content-Type",o),r(e.headers),f.onreadystatechange=function(){if(4===f.readyState){if(f.status>=200&&f.status<300||304===f.status){var e=f.responseText;try{"json"===u&&(e=JSON.parse(e)),d(e,f.status,f)}catch(t){c()}}else c();m(f,f.status)}},"POST"===i&&l?f.send(l):f.send()}function y(e,t,n){function r(e,r){var s=t[e],a=n.getCallback(e);
try{g({type:"post",url:s,data:r,dataType:"json",contentType:"json",success:function(e){a.onResult&&!i&&a.onResult(e)},error:function(){a.onError&&!i&&a.onError()},complete:function(){a.onEnd&&!i&&a.onEnd()}})}catch(o){}}var i=!1;this.destroy=function(){i=!0},this.addOrReplaceApi=function(e,n){t=t||{},t[e]=n},this.request=r}function v(){this.request=function(){},this.startHeartbeat=function(){},this.stopHeartbeat=function(){},this.destroy=function(){this.stopHeartbeat()},this.addOrReplaceApi=function(){}
}function S(t,n,r,i){function s(){document.getElementsByTagName("head")[0].removeChild(p),i.onEnd&&i.onEnd(n)}function a(e,t,n){e&&(e.addEventListener?e.addEventListener(t,n):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)}if(t&&n){i=i||{},r=r||function(){};var o="bcpsdk_"+encodeURIComponent(t.replace(/.*\//,"").replace(/\?.*/,""));e[o]=r,n.callback=encodeURIComponent(o),n.t=(new Date).getTime();var u=[],c=Object.prototype.toString;for(var d in n){var m,l="";if("number"==typeof n[d]&&(l=0),"[object Object]"===c.call(n[d])){try{m=JSON.stringify(n[d])
}catch(f){m="{}"}u.push(d+"="+encodeURIComponent(m))}else u.push(d+"="+encodeURIComponent(n[d]||l))}delete n.callback,u=u.join("&"),t+=-1!==t.indexOf("?")?"&"+u:"?"+u;var p=document.createElement("script");p.setAttribute("async","true"),a(p,"load",s),a(p,"error",function(){document.getElementsByTagName("head")[0].removeChild(p),i.onError&&i.onError(n)}),document.getElementsByTagName("head")[0].appendChild(p),p.src=t}}function _(t,n,r){function i(e,t){var i=n[e],s=r.getCallback(e);S(i,t,function(e){s.onResult&&!d&&s.onResult(e,t)
},{onError:function(){d||s.onError(t)},onEnd:function(){d||s.onEnd(t)}})}function s(t,n){c=e.setInterval(function(){i(t,n)},u)}function a(){e.clearInterval(c)}var o=t||{},u=o.heartDely||6e3,c=0,d=!1;this.destroy=function(){a(),d=!0},this.startHeartbeat=s,this.stopHeartbeat=a,this.request=i}function C(e){var t={system:{list:{},lastTime:0},message:{list:{},lastTime:0}},n=0,r={};this.init=function(t){r=t.messageTemp;for(var n=e.getHistory(),i=0;i<n.length;i++){var s=n[i];this.checkKefuMessage(s,!0)}},this.resetReadStatus=function(e){delete t.system.list[e]
},this.getData=function(){return t},this.setReadData=function(e){for(var n={},i=t.system,s=!1,a=0;a<e.length;a++){var o=e[a],u=o.user_message_id,c=parseInt(o.user_message_time,10)||0,d=o.is_read;c>i.lastTime&&(i.lastTime=c),i.lastTime=c,"0"!==i.list[u]&&r["send"+u]&&i.list[u]!==d&&(n[u]=d,i.list[u]=d,s=!0)}return s?n:!1},this.checkKefuMessage=function(r,i){if("service"===r.source&&"system"!==r.content_type){var s=r.message_id,a=r.message_time?parseInt(r.message_time,10):0;return t.message.lastTime<a&&(t.message.lastTime=a),(0===n||n>a)&&(n=a),s&&a?i?(t.message.list[s]=1,!1):n>a?!1:t.message.list[s]?!1:(t.message.list[s]=1,e.kefuMessageRead(r),!0):!0
}return!0}}function b(e,t,n){return t?t[e].apply(t,n):void 0}function k(e,t){t[e]=function(){return b(e,T,arguments)}}if(!e.BcpSdk){try{module.exports=t}catch(w){}try{module.exports=n}catch(w){}try{module.exports=r}catch(w){}i.prototype.encode=function(e,t){t=t||this._keyStr;var n,r,i,s,a,o,u,c="",d=0;for(e=this._utf8_encode(e);d<e.length;)n=e.charCodeAt(d++),r=e.charCodeAt(d++),i=e.charCodeAt(d++),s=n>>2,a=(3&n)<<4|r>>4,o=(15&r)<<2|i>>6,u=63&i,isNaN(r)?o=u=64:isNaN(i)&&(u=64),c=c+t.charAt(s)+t.charAt(a)+t.charAt(o)+t.charAt(u);
return c},i.prototype.decode=function(e,t){t=t||this._keyStr;var n,r,i,s,a,o,u,c="",d=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)s=t.indexOf(e.charAt(d++)),a=t.indexOf(e.charAt(d++)),o=t.indexOf(e.charAt(d++)),u=t.indexOf(e.charAt(d++)),n=s<<2|a>>4,r=(15&a)<<4|o>>2,i=(3&o)<<6|u,c+=String.fromCharCode(n),64!==o&&(c+=String.fromCharCode(r)),64!==u&&(c+=String.fromCharCode(i));return c=this._utf8_decode(c)},i.prototype._utf8_encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);
128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},i.prototype._utf8_decode=function(e){for(var t="",n=0,r=0,i=0,s=0;n<e.length;)r=e.charCodeAt(n),128>r?(t+=String.fromCharCode(r),n++):r>191&&224>r?(i=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&i),n+=2):(i=e.charCodeAt(n+1),s=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&s),n+=3);
return t};try{module.exports=i}catch(w){}try{module.exports=s}catch(w){}try{module.exports=a}catch(w){}try{module.exports=o}catch(w){}try{module.exports=u}catch(w){}try{module.exports=c}catch(w){}try{module.exports=m}catch(w){}try{module.exports=l}catch(w){}try{module.exports=f}catch(w){}try{module.exports=p}catch(w){}try{module.exports=h}catch(w){}y.prototype=new v,y.prototype.constructor=y,_.prototype=new v,_.prototype.constructor=_;var I={imlpApp:{appid:"wx2fde1496e4d81009",path:""},host:"https://ada.baidu.com",defaultImType:{name:"default",server:"bcp"},clientSdkDataTimeout:432e5};
!function(e){var t=[];t[0]={name:"爱番番",server:"bcp"},t[1]={name:"商务通",server:"bcp"},t[2]={name:"53客服",server:"bcp"},t[3]={name:"快商通",server:"bcp"},t[4]={name:"ai客服",server:"aiservice"},t[5]={name:"咨询分诊",server:"guide"},t[6]={name:"乐语",server:"bcp"},t[7]={name:"美洽",server:"bcp"},t[8]={name:"易聊通",server:"bcp"},t[9]={name:"螳螂",server:"bcp"},t[10]={name:"鱼塘",server:"bcp"},t[11]={name:"live800",server:"bcp"},t[12]={name:"小能",server:"bcp"},t[10001]={name:"熊掌号",server:"bcp"},e.imTypes=t}(I);try{module.exports=I
}catch(w){}try{module.exports=C}catch(w){}for(var E=["init","on","connect","send","leaveWord","reset","getData","disconnect","getHistory","resend","getConnectState","isInit","resetFreeTime","sendUserAction","sendUserState"],T=null,P={},R=0;R<E.length;R++){var D=E[R];k(D,P)}P.init=function(i,d,v){return T=new a(e,{EventEmitter:r,FreeTimeModel:u,getImCallbacks:c,Callback:n,Util:o,EntrySite:t,SdkDataModel:m,StorageModel:l,HistoryModel:f,SaveDataModel:p,SyncMessageModel:h,request:{GetRequest:_,PostRequest:y},sdkConfig:I,FetchData:s,host:v.host,MessageStatusManager:C}),T.init(i,d,v)
},e.BcpSdk=P}}(window);